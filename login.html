<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Connexion ‚Äî Ma Money</title>
<link rel="stylesheet" href="style.css">

<style>

/* RESET BACKGROUND */
body {
  background: black !important;
}

/* BACKGROUND WALL */
.hero-wall {
  position: fixed;
  inset: 0;
  z-index: -2;
  overflow: hidden;
}

.hero-wall video,
.hero-wall img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  filter: brightness(0.35);
}

/* DARK OVERLAY */
.overlay-dark {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.45);
  z-index: -1;
}

/* CENTER CONTENT */
main {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 75vh;
}

/* LOGIN CARD */
.login-card {
  background: rgba(255,255,255,0.97);
  backdrop-filter: blur(14px);
  padding: 30px;
  border-radius: 20px;
  box-shadow: 0 15px 50px rgba(0,0,0,0.25);
  max-width: 380px;
  width: 100%;
  animation: fadeIn 0.9s ease;
}

/* FADE ANIMATION */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(35px); }
  to { opacity: 1; transform: translateY(0); }
}

/* FOOTER */
footer {
  text-align: center;
  padding: 18px;
  color: white;
  background: rgba(0,0,0,0.6);
  font-size: 14px;
}

</style>
</head>

<body>

<header>
<h1>üîê Ma Money ‚Äî Connexion</h1>
</header>

<!-- BACKGROUND MEDIA -->
<div class="hero-wall">
  <video id="bgVideo" autoplay muted loop playsinline></video>
  <img id="bgImage" hidden>
</div>

<div class="overlay-dark"></div>

<main>
<section class="login-card">

<h2>Connexion s√©curis√©e</h2>

<form id="loginForm">

<label>üì± Num√©ro</label>
<input type="text" id="phone" placeholder="Ex: 99999999" required>

<label>üîë Mot de passe</label>
<input type="password" id="password" placeholder="Mot de passe" required>

<button type="submit">Se connecter</button>

</form>

<p id="error" class="error"></p>

</section>
</main>

<footer>
<strong>Ma Money üá≤üá±</strong> ‚Äî Paiement num√©rique s√©curis√©<br>
üîí Transactions crypt√©es ‚Ä¢ Donn√©es prot√©g√©es<br>
‚ú® <em>"Votre argent en s√©curit√©, votre avenir en confiance."</em>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyD3XGP0vqqCwKftSvn1M72N_O0lxtIjzFc",
  authDomain: "ma-money-2841e.firebaseapp.com",
  databaseURL: "https://ma-money-2841e-default-rtdb.firebaseio.com",
  projectId: "ma-money-2841e"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* LOAD BACKGROUND FROM ADS */
async function loadAds(){
  const snap = await get(ref(db,"ads"));
  const data = snap.val() || {};
  const video = document.getElementById("bgVideo");
  const image = document.getElementById("bgImage");

  if(data.type === "video"){
    video.src = data.url;
    video.hidden = false;
    image.hidden = true;
  } else {
    image.src = data.url;
    image.hidden = false;
    video.hidden = true;
  }
}
loadAds();

/* LOGIN SYSTEM */
document.getElementById("loginForm").addEventListener("submit", async (e)=>{
e.preventDefault();

const phone = document.getElementById("phone").value.trim();
const password = document.getElementById("password").value.trim();
const error = document.getElementById("error");

error.innerText = "";

try {
const userRef = ref(db, "users/" + phone);
const snap = await get(userRef);

/* ADMIN BACKUP MODE */
if(phone === "99999999" && password === "admin123" && !snap.exists()){
  await set(userRef, {
    phone: "99999999",
    password: "admin123",
    name: "Administrateur",
    solde: 1000000,
    role: "admin",
    frozen: false
  });
}

const newSnap = await get(userRef);

if(!newSnap.exists()){
error.innerText = "‚ùå Num√©ro introuvable";
return;
}

const user = newSnap.val();

if(user.password !== password){
error.innerText = "‚ùå Mot de passe incorrect";
return;
}

localStorage.setItem("loggedUser", JSON.stringify(user));

window.location.href = user.role === "admin" ? "admin.html" : "dashboard.html";

} catch {
error.innerText = "‚ùå Erreur Firebase";
}
});
</script>

</body>
</html>
